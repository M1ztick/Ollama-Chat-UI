<?php

/**
 * Plugin Name: Ollama Chat Widget - Mistyk Media
 * Plugin URI: https://mistykmedia.com
 * Description: A sarcastic, witty AI assistant widget for MistykMedia.com
 * Version: 1.0.1
 * Author: Misty (M1ztick)
 * Author URI: https://mistykmedia.com
 * License: GPL v2 or later
 * Text Domain: ollama-chat-widget
 */

defined('ABSPATH') || exit;

class OllamaChatWidget
{
    private static $instance = null;

    private function __construct()
    {
        $this->init_hooks();
    }

    /**
     * Register public hooks.
     */
    private function init_hooks()
    {
        add_action('wp_enqueue_scripts', [$this, 'enqueue_scripts']);
        add_action('wp_footer', [$this, 'render_chat_widget']);
    }

    /**
     * Enqueue front-end scripts and styles.
     */
    public function enqueue_scripts()
    {
        wp_enqueue_style(
            'ollama-chat-widget-css',
            OCW_PLUGIN_URL . 'build/index.css',
            [],
            OCW_VERSION
        );

        wp_enqueue_script(
            'ollama-chat-widget-js',
            OCW_PLUGIN_URL . 'build/index.js',
            ['wp-element'], // Add other dependencies as needed
            OCW_VERSION,
            true
        );

        // Pass variables to JS if needed
        wp_localize_script('ollama-chat-widget-js', 'ocwData', [
            'ajaxUrl' => admin_url('admin-ajax.php'),
            'nonce'   => wp_create_nonce('ocw_nonce'),
            'siteUrl' => home_url(),
        ]);
    }

    /**
     * Output the chat widget container to the footer.
     */
    public function render_chat_widget()
    {
        echo '<div id="ollama-chat-widget-root"></div>';
    }

    /**
     * Get singleton instance.
     */
    public static function get_instance()
    {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
}

// Hook into plugins_loaded to define constants and initialize the plugin.
add_action('plugins_loaded', function () {
    if (!defined('OCW_VERSION')) {
        define('OCW_VERSION', '1.0.1');
    }
    if (!defined('OCW_PLUGIN_URL')) {
        define('OCW_PLUGIN_URL', plugin_dir_url(__FILE__));
    }
    if (!defined('OCW_PLUGIN_PATH')) {
        define('OCW_PLUGIN_PATH', plugin_dir_path(__FILE__));
    }

    OllamaChatWidget::get_instance();
});
